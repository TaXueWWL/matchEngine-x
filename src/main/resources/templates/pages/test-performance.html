<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- Test Performance Monitoring Content Fragment -->
<div th:fragment="content">
    <style>
        .test-card {
            border: 2px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            background: white;
        }

        body.dark-theme .test-card {
            background: #1a1a1a;
            color: #fff;
        }
    </style>

    <h1>æ€§èƒ½ç›‘æ§æµ‹è¯•é¡µé¢</h1>

    <div class="test-card">
        <h3>åŸºç¡€åŠŸèƒ½æµ‹è¯•</h3>
        <p>çŠ¶æ€: <span id="test-status">åˆå§‹åŒ–ä¸­...</span></p>
        <p>æ—¶é—´: <span id="test-time">-</span></p>
        <button onclick="testBasicFunction()">æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
    </div>

    <div class="test-card">
        <h3>APIæµ‹è¯•ç»“æœ</h3>
        <div id="api-results">
            <p>Health API: <span id="health-result">æµ‹è¯•ä¸­...</span></p>
            <p>Disruptor API: <span id="disruptor-result">æµ‹è¯•ä¸­...</span></p>
            <p>WebSocket API: <span id="websocket-result">æµ‹è¯•ä¸­...</span></p>
        </div>
        <button onclick="testAllAPIs()">æµ‹è¯•æ‰€æœ‰API</button>
    </div>

    <script>
        console.log('ğŸ§ª Test performance page loaded');

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… DOM Content Loaded');

            // æ›´æ–°æ—¶é—´
            updateTime();

            // è®¾ç½®çŠ¶æ€
            const statusEl = document.getElementById('test-status');
            if (statusEl) {
                statusEl.textContent = 'DOMåŠ è½½å®Œæˆ';
                console.log('âœ… Status updated');
            }

            // è‡ªåŠ¨æµ‹è¯•API
            setTimeout(() => {
                testAllAPIs();
            }, 1000);
        });

        function updateTime() {
            const timeEl = document.getElementById('test-time');
            if (timeEl) {
                timeEl.textContent = new Date().toLocaleTimeString();
            }
        }

        function testBasicFunction() {
            console.log('ğŸ”§ Testing basic function');
            const statusEl = document.getElementById('test-status');
            if (statusEl) {
                statusEl.textContent = 'åŸºç¡€åŠŸèƒ½æ­£å¸¸';
            }
            updateTime();
            alert('åŸºç¡€JavaScriptåŠŸèƒ½æ­£å¸¸!');
        }

        async function testAllAPIs() {
            console.log('ğŸŒ Testing all APIs');

            // Test Health API
            try {
                console.log('Testing health API...');
                const healthResponse = await fetch('/api/performance/health');
                const healthData = await healthResponse.json();
                console.log('Health API response:', healthData);
                document.getElementById('health-result').textContent = healthData.status || 'OK';
                document.getElementById('health-result').style.color = 'green';
            } catch (error) {
                console.error('Health API error:', error);
                document.getElementById('health-result').textContent = 'Error: ' + error.message;
                document.getElementById('health-result').style.color = 'red';
            }

            // Test Disruptor API
            try {
                console.log('Testing disruptor API...');
                const disruptorResponse = await fetch('/api/performance/disruptor');
                const disruptorData = await disruptorResponse.json();
                console.log('Disruptor API response:', disruptorData);
                document.getElementById('disruptor-result').textContent = disruptorData.status || 'OK';
                document.getElementById('disruptor-result').style.color = 'green';
            } catch (error) {
                console.error('Disruptor API error:', error);
                document.getElementById('disruptor-result').textContent = 'Error: ' + error.message;
                document.getElementById('disruptor-result').style.color = 'red';
            }

            // Test WebSocket API
            try {
                console.log('Testing websocket API...');
                const websocketResponse = await fetch('/api/performance/websocket-push');
                const websocketData = await websocketResponse.json();
                console.log('WebSocket API response:', websocketData);
                document.getElementById('websocket-result').textContent = websocketData.status || 'OK';
                document.getElementById('websocket-result').style.color = 'green';
            } catch (error) {
                console.error('WebSocket API error:', error);
                document.getElementById('websocket-result').textContent = 'Error: ' + error.message;
                document.getElementById('websocket-result').style.color = 'red';
            }

            console.log('âœ… API testing completed');
        }

        // æ¯ç§’æ›´æ–°æ—¶é—´
        setInterval(updateTime, 1000);
    </script>
</div>

</html>