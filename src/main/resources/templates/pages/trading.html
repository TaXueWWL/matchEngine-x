<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- Content Fragment -->
<div th:fragment="content">
    <!-- Connection Status -->
    <div class="connection-status">
        <span id="connection-status" class="badge disconnected">未连接</span>
    </div>

    <!-- Trading Pair Header -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h4 class="mb-0">
                                <i class="fas fa-exchange-alt me-2"></i>
                                <span id="current-symbol" th:text="${symbol}">BTCUSDT</span>
                            </h4>
                            <small class="text-muted">当前交易对</small>
                        </div>
                        <div class="text-end">
                            <h5 class="mb-0 text-success" id="current-price">¥50,000.00</h5>
                            <small class="text-success">+2.5%</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Left Column: Order Book and Recent Trades -->
        <div class="col-lg-4">
            <!-- Order Book -->
            <div class="card mb-3">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="fas fa-list me-2"></i>
                        订单簿
                    </h6>
                    <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-secondary active" data-precision="2">0.01</button>
                        <button type="button" class="btn btn-outline-secondary" data-precision="1">0.1</button>
                        <button type="button" class="btn btn-outline-secondary" data-precision="0">1</button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="orderbook-container">
                        <!-- Header -->
                        <div class="orderbook-header">
                            <div class="row text-center small text-muted py-2 bg-light">
                                <div class="col-4">价格(USDT)</div>
                                <div class="col-4">数量(BTC)</div>
                                <div class="col-4">累计(BTC)</div>
                            </div>
                        </div>

                        <!-- Sell Orders (Asks) - Reversed order (lowest first) -->
                        <div class="sell-orders-section">
                            <div id="sell-orders-body" class="orderbook-levels">
                                <div class="text-center text-muted py-3">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <small class="d-block mt-1">加载中...</small>
                                </div>
                            </div>
                        </div>

                        <!-- Current Price Spread -->
                        <div class="current-price-section">
                            <div class="text-center py-3 border-top border-bottom">
                                <div class="current-price" id="current-price">
                                    <span class="price-value text-success fw-bold" id="last-price">--</span>
                                    <small class="price-change text-success ms-2" id="price-change">+???%</small>
                                    <small class="text-muted d-block" id="price-label">≈ $???</small>
                                </div>
                            </div>
                        </div>

                        <!-- Buy Orders (Bids) - Normal order (highest first) -->
                        <div class="buy-orders-section">
                            <div id="buy-orders-body" class="orderbook-levels">
                                <div class="text-center text-muted py-3">
                                    <div class="spinner-border spinner-border-sm" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <small class="d-block mt-1">加载中...</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Forms -->
            <div class="row">
                <!-- Buy Form -->
                <div class="col-6">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0">买入</h6>
                        </div>
                        <div class="card-body">
                            <form id="buy-order-form">
                                <div class="mb-2">
                                    <label for="buy-price" class="form-label">价格</label>
                                    <input type="number" class="form-control form-control-sm" id="buy-price"
                                           step="0.01" min="0" placeholder="0.00">
                                </div>
                                <div class="mb-2">
                                    <label for="buy-quantity" class="form-label">数量</label>
                                    <input type="number" class="form-control form-control-sm" id="buy-quantity"
                                           step="0.001" min="0" placeholder="0.000">
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">
                                        总额: ¥<span id="buy-total">0.00</span>
                                    </small>
                                </div>
                                <button type="submit" class="btn btn-success w-100 btn-sm">
                                    <i class="fas fa-arrow-up me-1"></i>买入
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Sell Form -->
                <div class="col-6">
                    <div class="card">
                        <div class="card-header bg-danger text-white">
                            <h6 class="mb-0">卖出</h6>
                        </div>
                        <div class="card-body">
                            <form id="sell-order-form">
                                <div class="mb-2">
                                    <label for="sell-price" class="form-label">价格</label>
                                    <input type="number" class="form-control form-control-sm" id="sell-price"
                                           step="0.01" min="0" placeholder="0.00">
                                </div>
                                <div class="mb-2">
                                    <label for="sell-quantity" class="form-label">数量</label>
                                    <input type="number" class="form-control form-control-sm" id="sell-quantity"
                                           step="0.001" min="0" placeholder="0.000">
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">
                                        总额: ¥<span id="sell-total">0.00</span>
                                    </small>
                                </div>
                                <button type="submit" class="btn btn-danger w-100 btn-sm">
                                    <i class="fas fa-arrow-down me-1"></i>卖出
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Column: K-Line Chart -->
        <div class="col-lg-5">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0">
                        <i class="fas fa-chart-candlestick me-2"></i>
                        K线图
                    </h6>
                    <div class="btn-group btn-group-sm" role="group">
                        <button type="button" class="btn btn-outline-secondary active" data-timeframe="1m">1分钟</button>
                        <button type="button" class="btn btn-outline-secondary" data-timeframe="5m">5分钟</button>
                        <button type="button" class="btn btn-outline-secondary" data-timeframe="15m">15分钟</button>
                        <button type="button" class="btn btn-outline-secondary" data-timeframe="1h">1小时</button>
                        <button type="button" class="btn btn-outline-secondary" data-timeframe="1d">1天</button>
                    </div>
                </div>
                <div class="card-body p-2">
                    <div class="kline-container" style="height: 400px; position: relative;">
                        <div id="kline-chart" style="width: 100%; height: 100%;"></div>
                        <div class="kline-loading text-center" id="kline-loading">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">加载K线数据...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Order History and Balance -->
        <div class="col-lg-3">
            <!-- User Balance -->
            <div class="card mb-3">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-wallet me-2"></i>
                        账户余额
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-12 mb-2">
                            <div class="d-flex justify-content-between">
                                <span>USDT:</span>
                                <strong id="balance-USDT">Loading...</strong>
                            </div>
                        </div>
                        <div class="col-12 mb-2">
                            <div class="d-flex justify-content-between">
                                <span th:text="${symbol != null ? symbol.substring(0, symbol.length() - 4) : 'BTC'}">BTC:</span>
                                <strong id="balance-BTC">Loading...</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Orders Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <ul class="nav nav-tabs card-header-tabs" id="orderTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="current-orders-tab" data-bs-toggle="tab"
                                    data-bs-target="#current-orders" type="button" role="tab">
                                <i class="fas fa-list me-1"></i>当前订单
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="order-history-tab" data-bs-toggle="tab"
                                    data-bs-target="#order-history" type="button" role="tab">
                                <i class="fas fa-history me-1"></i>历史订单
                            </button>
                        </li>
                    </ul>
                    <button class="btn btn-sm btn-outline-primary" onclick="refreshActiveTab()">
                        <i class="fas fa-refresh me-1"></i>刷新
                    </button>
                </div>
                <div class="card-body p-0">
                    <div class="tab-content" id="orderTabContent">
                        <!-- Current Orders Tab -->
                        <div class="tab-pane fade show active" id="current-orders" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>订单ID</th>
                                            <th>交易对</th>
                                            <th>方向</th>
                                            <th>类型</th>
                                            <th>价格</th>
                                            <th>数量</th>
                                            <th>已成交</th>
                                            <th>状态</th>
                                            <th>时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody id="current-orders-body">
                                        <tr>
                                            <td colspan="10" class="text-center text-muted py-4">
                                                <div class="spinner-border spinner-border-sm" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                                <p class="mt-2 mb-0">正在加载当前订单...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Order History Tab -->
                        <div class="tab-pane fade" id="order-history" role="tabpanel">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>订单ID</th>
                                            <th>交易对</th>
                                            <th>方向</th>
                                            <th>类型</th>
                                            <th>价格</th>
                                            <th>数量</th>
                                            <th>已成交</th>
                                            <th>状态</th>
                                            <th>时间</th>
                                        </tr>
                                    </thead>
                                    <tbody id="order-history-body">
                                        <tr>
                                            <td colspan="9" class="text-center text-muted py-4">
                                                <div class="spinner-border spinner-border-sm" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                                <p class="mt-2 mb-0">正在加载历史订单...</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modify Order Modal -->
<div class="modal fade" id="modifyOrderModal" tabindex="-1" aria-labelledby="modifyOrderModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modifyOrderModalLabel">修改订单</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="modify-order-form">
                    <div class="mb-3">
                        <label for="modify-order-id" class="form-label">订单ID</label>
                        <input type="text" class="form-control" id="modify-order-id" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="modify-order-symbol" class="form-label">交易对</label>
                        <input type="text" class="form-control" id="modify-order-symbol" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="modify-order-price" class="form-label">新价格</label>
                        <input type="number" class="form-control" id="modify-order-price"
                               step="0.01" min="0" placeholder="0.00" required>
                    </div>
                    <div class="mb-3">
                        <label for="modify-order-quantity" class="form-label">新数量</label>
                        <input type="number" class="form-control" id="modify-order-quantity"
                               step="0.001" min="0" placeholder="0.000" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="submitModifyOrder()">确认修改</button>
            </div>
        </div>
    </div>
</div>

<!-- Scripts Fragment -->
<div th:fragment="scripts">
    <script>
    </script>
</div>

</html>